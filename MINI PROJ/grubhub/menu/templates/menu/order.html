{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>GrubHub - Order Now</title>
    {% csrf_token %}
    <style>
        :root {
            --primary-color: #8B4513;  /* Brown */
            --secondary-color: #FF4500;  /* Red */
            --accent-color: #FFD700;  /* Yellow */
            --dark-color: #2C1810;  /* Dark Brown */
            --light-color: #FFF8DC;  /* Light Yellow */
        }

        body {
            background: linear-gradient(135deg, var(--dark-color), var(--primary-color));
            color: var(--light-color);
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .header {
            background: rgba(44, 24, 16, 0.95);
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 2rem;
        }

        .search-input {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid var(--accent-color);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-color);
            font-size: 1rem;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .nav-button {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: var(--light-color);
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        }

        .order-type-toggle {
            display: none;
        }

        .toggle-switch {
            display: none;
        }

        .slider {
            display: none;
        }

        .order-container {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            gap: 2rem;
        }

        .filters {
            width: 300px;
            background: rgba(44, 24, 16, 0.95);
            padding: 1.5rem;
            border-radius: 15px;
            height: fit-content;
            position: sticky;
            top: 100px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filters h2 {
            color: var(--accent-color);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .filter-group {
            margin-bottom: 2rem;
        }

        .filter-group h3 {
            color: var(--light-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-option {
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--light-color);
        }

        .filter-option:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .filter-option.active {
            background: var(--accent-color);
            color: var(--dark-color);
        }

        .main-content {
            flex: 1;
            min-width: 0;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .product-content {
            padding: 1.5rem;
        }

        .product-title {
            color: var(--accent-color);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .product-description {
            color: var(--light-color);
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .product-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .product-price {
            color: var(--accent-color);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .preparation-time {
            color: var(--light-color);
            opacity: 0.8;
        }

        .product-button {
            width: 100%;
            padding: 0.8rem;
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: var(--light-color);
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .product-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .product-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .cart-panel {
            position: fixed;
            top: 0;
            right: -400px;  /* Start off-screen */
            width: 400px;
            height: 100vh;
            background: rgba(44, 24, 16, 0.98);
            box-shadow: -4px 0 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        .cart-panel.show {
            right: 0;  /* Slide in when shown */
        }

        .cart-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            color: var(--accent-color);
            margin: 0;
        }

        .close-cart {
            background: none;
            border: none;
            color: var(--light-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .close-cart:hover {
            color: var(--accent-color);
            transform: rotate(90deg);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.3s ease;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 1rem;
            border: 2px solid var(--accent-color);
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            color: var(--accent-color);
            font-size: 1.1rem;
            margin: 0 0 0.5rem 0;
        }

        .cart-item-price {
            color: var(--light-color);
            font-size: 1rem;
            margin: 0;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .quantity-btn {
            background: var(--secondary-color);
            color: var(--light-color);
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .quantity-btn:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }

        .quantity-value {
            color: var(--light-color);
            font-size: 1rem;
            min-width: 25px;
            text-align: center;
        }

        .remove-item {
            background: none;
            border: none;
            color: #ff4444;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }

        .remove-item:hover {
            color: #ff0000;
            transform: scale(1.1);
        }

        .cart-summary {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            color: var(--light-color);
        }

        .summary-row.total {
            color: var(--accent-color);
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checkout-btn {
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: var(--light-color);
            padding: 1rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-top: 1rem;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        }

        .empty-cart {
            text-align: center;
            padding: 2rem;
        }

        .empty-cart i {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        .empty-cart h3 {
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }

        .empty-cart p {
            color: var(--light-color);
            margin-bottom: 1.5rem;
        }

        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cart-overlay.active {
            display: block;
            opacity: 1;
        }

        .ribbon {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            padding: 1rem 2rem;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .ribbon:hover {
            transform: translateY(-50%) translateX(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .ribbon-button {
            background: none;
            border: none;
            color: var(--light-color);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .cart-count {
            background: var(--accent-color);
            color: var(--dark-color);
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(44, 24, 16, 0.98);
            border-radius: 15px;
            margin-top: 0.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid var(--accent-color);
        }

        .search-results.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-result-item {
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .search-result-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--accent-color);
        }

        .search-result-details {
            flex: 1;
        }

        .search-result-details h3 {
            color: var(--accent-color);
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-result-details p {
            color: var(--light-color);
            margin: 0.3rem 0 0;
            font-size: 0.9rem;
            opacity: 0.8;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .search-result-price {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 1.1rem;
            margin-left: 1rem;
            white-space: nowrap;
        }

        .search-result-category {
            font-size: 0.8rem;
            color: var(--accent-color);
            opacity: 0.8;
            margin-top: 0.2rem;
        }

        .search-result-availability {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .search-result-available {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }

        .search-result-unavailable {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0000;
        }

        .search-highlight {
            background: rgba(255, 215, 0, 0.3);
            padding: 0 0.2rem;
            border-radius: 2px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: var(--light-color);
            padding: 1rem 2rem;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(120%);
            animation: slideIn 0.5s ease forwards;
            opacity: 0;
        }

        .toast.success {
            background: linear-gradient(45deg, #00b894, #00cec9);
        }

        .toast.error {
            background: linear-gradient(45deg, #d63031, #e17055);
        }

        .toast i {
            font-size: 1.2rem;
        }

        @keyframes slideIn {
            0% {
                transform: translateX(120%);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(120%);
                opacity: 0;
            }
        }

        .search-result-cart-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: var(--light-color);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            z-index: 2;
        }

        .search-result-item:hover .search-result-cart-btn {
            opacity: 1;
        }

        .search-result-cart-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .search-result-cart-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        .search-result-cart-btn i {
            font-size: 1.2rem;
        }

        .search-result-cart-btn.disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: translateY(-50%) scale(1);
        }

        .search-result-cart-btn.disabled:hover {
            transform: translateY(-50%) scale(1);
            box-shadow: none;
        }

        /* Confirmation Dialog Styles */
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .confirmation-dialog.active {
            opacity: 1;
            visibility: visible;
        }

        .confirmation-content {
            background: var(--dark-color);
            padding: 2rem;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            border: 2px solid var(--accent-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .confirmation-dialog.active .confirmation-content {
            transform: translateY(0);
        }

        .confirmation-content h3 {
            color: var(--accent-color);
            margin: 0 0 1rem 0;
            font-size: 1.5rem;
            text-align: center;
        }

        .confirmation-content p {
            color: var(--light-color);
            margin: 0 0 1.5rem 0;
            text-align: center;
            opacity: 0.9;
        }

        .confirmation-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirmation-btn {
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirmation-btn.confirm {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
        }

        .confirmation-btn.cancel {
            background: linear-gradient(45deg, #d63031, #e17055);
            color: white;
        }

        .confirmation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Cart Item Animation */
        @keyframes addToCart {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        .cart-item {
            animation: addToCart 0.3s ease;
        }

        /* Cart Count Animation */
        @keyframes cartCountUpdate {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
                background: var(--accent-color);
            }
            100% {
                transform: scale(1);
            }
        }

        .cart-count-update {
            animation: cartCountUpdate 0.3s ease;
        }

        .header-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .cart-button {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cart-button .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-color);
            color: var(--dark-color);
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-weight: bold;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <div class="header">
        <div class="nav-buttons">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search for food..." id="searchInput">
                <div class="search-results" id="searchResults"></div>
            </div>
            <div class="header-buttons">
                <a href="{% url 'menu:x_page' %}" class="nav-button">
                    <i class="fas fa-check-circle"></i>
                    Proceed to Checkout
                </a>
                <a href="{% url 'menu:logout' %}" class="nav-button">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>
    </div>

    <div class="order-container">
        <div class="cart-panel">
            <div class="cart-header">
                <h2>Your Cart</h2>
            </div>
            <div class="cart-items">
                <!-- Cart items will be dynamically inserted here -->
            </div>
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span id="cart-subtotal">₹0.00</span>
                </div>
                <div class="summary-row">
                    <span>Tax (5%)</span>
                    <span id="cart-tax">₹0.00</span>
                </div>
                <div class="summary-row">
                    <span>Delivery Fee</span>
                    <span>₹40.00</span>
                </div>
                <div class="summary-row total">
                    <span>Total</span>
                    <span id="cart-total">₹0.00</span>
                </div>
                <a href="{% url 'menu:x_page' %}" class="checkout-btn" onclick="return validateCheckout(event)">
                    <i class="fas fa-check-circle"></i>
                    Proceed to Checkout
                </a>
            </div>
        </div>

        <div class="filters">
            <h2>Filters</h2>
            <div class="filter-group">
                <h3>Categories</h3>
                <div class="filter-options">
                    <div class="filter-option active" data-category="all">
                        <i class="fas fa-th-large"></i>
                        All Items
                    </div>
                    {% for category in categories %}
                        <div class="filter-option" data-category="{{ category }}">
                            {% if category == "Snacks" %}
                                <i class="fas fa-cookie-bite"></i>
                            {% elif category == "Beverages" %}
                                <i class="fas fa-coffee"></i>
                            {% elif category == "Meals" %}
                                <i class="fas fa-utensils"></i>
                            {% elif category == "Desserts" %}
                                <i class="fas fa-ice-cream"></i>
                            {% elif category == "Chinese" %}
                                <i class="fas fa-utensils"></i>
                            {% else %}
                                <i class="fas fa-hamburger"></i>
                            {% endif %}
                            {{ category }}
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="filter-group">
                <h3>Availability</h3>
                <div class="filter-options">
                    <div class="filter-option" data-availability="all">
                        <i class="fas fa-check-circle"></i>
                        All Items
                    </div>
                    <div class="filter-option" data-availability="available">
                        <i class="fas fa-check-circle"></i>
                        Available Only
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="products-grid">
                {% if menu %}
                    {% for item in menu %}
                        <div class="product-card" data-category="{{ item.category }}" data-availability="{{ item.availability|lower }}" data-item-id="{{ item.id }}">
                            {% if item.image %}
                                <img src="{{ item.image.url }}" alt="{{ item.name }}" class="product-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiM4QjQ1MTMiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCI+RGVsbGljaW91cyBGb29kPC90ZXh0Pjwvc3ZnPg=='">
                            {% else %}
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiM4QjQ1MTMiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCI+RGVsbGljaW91cyBGb29kPC90ZXh0Pjwvc3ZnPg==" alt="{{ item.name }}" class="product-image">
                            {% endif %}
                            <div class="product-content">
                                <h3 class="product-title">{{ item.name }}</h3>
                                <p class="product-description">{{ item.description }}</p>
                                <div class="product-info">
                                    <div class="product-price">₹{{ item.price }}</div>
                                    <div class="preparation-time">
                                        <i class="fas fa-clock"></i>
                                        {{ item.preparation_time }} mins
                                    </div>
                                </div>
                                {% if user.is_authenticated %}
                                    {% if item.availability %}
                                        <button class="product-button" onclick="addToCart({{ item.id }})">Add to Cart</button>
                                    {% else %}
                                        <button class="product-button" disabled>Out of Stock</button>
                                    {% endif %}
                                {% else %}
                                    <button class="product-button" onclick="window.location.href='/admin/login/'">Login to Order</button>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="error-message">
                        <h2>No menu items available</h2>
                        <p>Please try again later or contact support if the issue persists.</p>
                        {% if debug_info %}
                            <pre>{{ debug_info|pprint }}</pre>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="ribbon" onclick="toggleCart()">
        <button class="ribbon-button">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count">{{ cart_count }}</span>
        </button>
    </div>

    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="confirmation-content">
            <h3>Confirm Action</h3>
            <p>Are you sure you want to remove this item from your cart?</p>
            <div class="confirmation-buttons">
                <button class="confirmation-btn confirm">Confirm</button>
                <button class="confirmation-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <div class="cart-overlay" onclick="toggleCart()"></div>

    <script>
        // Function to toggle cart panel
        function toggleCart() {
            const cartPanel = document.querySelector('.cart-panel');
            const cartOverlay = document.querySelector('.cart-overlay');
            
            if (cartPanel) {
                cartPanel.classList.toggle('show');
                if (cartOverlay) {
                    cartOverlay.classList.toggle('active');
                }
                
                // If cart is being shown, update its content
                if (cartPanel.classList.contains('show')) {
                    fetchCartItems();
                }
            }
        }

        // Function to fetch and update cart items
        function fetchCartItems() {
            fetch('{% url "menu:view_cart" %}')
                .then(response => response.json())
                .then(data => {
                    if (data.cart_items) {
                        updateCartPanel(data.cart_items);
                    }
                })
                .catch(error => {
                    console.error('Error fetching cart items:', error);
                    showToast('Failed to load cart items', 'error');
                });
        }

        // Function to close cart when clicking outside
        function closeCartOnOutsideClick(event) {
            const cartPanel = document.querySelector('.cart-panel');
            const cartOverlay = document.querySelector('.cart-overlay');
            const ribbon = document.querySelector('.ribbon');
            
            if (cartPanel && cartOverlay) {
                if (!cartPanel.contains(event.target) && !ribbon.contains(event.target)) {
                    cartPanel.classList.remove('show');
                    cartOverlay.classList.remove('active');
                }
            }
        }

        // Add event listener for clicking outside
        document.addEventListener('click', closeCartOnOutsideClick);

        // Function to validate checkout
        function validateCheckout(event) {
            event.preventDefault();
            const cartCount = parseInt(document.querySelector('.cart-count').textContent) || 0;
            if (cartCount === 0) {
                showToast('Your cart is empty. Please add items before proceeding to checkout.', 'error');
                return false;
            }
            // If cart has items, proceed to checkout
            window.location.href = "{% url 'menu:checkout' %}";
            return true;
        }

        // Function to update cart count
        function updateCartCount(count) {
            const cartCounts = document.querySelectorAll('.cart-count');
            cartCounts.forEach(element => {
                element.textContent = count;
                element.classList.add('cart-count-update');
                setTimeout(() => element.classList.remove('cart-count-update'), 300);
            });
        }

        // Function to update cart panel
        function updateCartPanel(cartItems) {
            const cartItemsContainer = document.querySelector('.cart-items');
            const cartSubtotal = document.querySelector('#cart-subtotal');
            const cartTax = document.querySelector('#cart-tax');
            const cartTotal = document.querySelector('#cart-total');
            
            if (!cartItemsContainer) return;

            // Update cart count
            updateCartCount(cartItems ? cartItems.length : 0);

            if (!cartItems || cartItems.length === 0) {
                cartItemsContainer.innerHTML = '<p class="empty-cart">Your cart is empty</p>';
                cartSubtotal.textContent = '₹0.00';
                cartTax.textContent = '₹0.00';
                cartTotal.textContent = '₹0.00';
                return;
            }

            const html = cartItems.map(item => `
                <div class="cart-item" data-item-id="${item.id}">
                    <img src="${item.item.image}" alt="${item.item.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiM4QjQ1MTMiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCI+RGVsbGljaW91cyBGb29kPC90ZXh0Pjwvc3ZnPg=='">
                    <div class="cart-item-details">
                        <h3 class="cart-item-name">${item.item.name}</h3>
                        <p class="cart-item-price">₹${item.item.price}</p>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn" onclick="updateCart(${item.item.id}, ${item.quantity - 1})">-</button>
                            <span class="quantity-value">${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateCart(${item.item.id}, ${item.quantity + 1})">+</button>
                        </div>
                    </div>
                    <button class="remove-item" onclick="removeFromCart(${item.item.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');

            cartItemsContainer.innerHTML = html;

            // Update cart totals
            const subtotal = cartItems.reduce((sum, item) => sum + (item.item.price * item.quantity), 0);
            const tax = subtotal * 0.05;
            const deliveryFee = 40;
            const total = subtotal + tax + deliveryFee;

            if (total <= 0) {
                showToast('Your cart is empty. Please add items before proceeding to payment.', 'error');
                return;
            }

            cartSubtotal.textContent = `₹${subtotal.toFixed(2)}`;
            cartTax.textContent = `₹${tax.toFixed(2)}`;
            cartTotal.textContent = `₹${total.toFixed(2)}`;
        }

        // Function to add item to cart
        function addToCart(itemId) {
            // Show loading state
            const button = event.target.closest('button');
            if (button) {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            }

            // Get CSRF token
            const csrfToken = getCookie('csrftoken');
            if (!csrfToken) {
                showToast('Session expired. Please refresh the page.', 'error');
                if (button) {
                    button.disabled = false;
                    button.innerHTML = 'Add to Cart';
                }
                return;
            }

            fetch(`{% url 'menu:add_to_cart' 0 %}`.replace('0', itemId), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({ quantity: 1 })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, 'error');
                } else {
                    showToast('Item added to cart successfully!');
                    updateCartCount(data.cart_items.length);
                    updateCartPanel(data.cart_items);
                    // Show cart panel after adding item
                    toggleCart();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Failed to add item to cart. Please try again.', 'error');
            })
            .finally(() => {
                if (button) {
                    button.disabled = false;
                    button.innerHTML = 'Add to Cart';
                }
            });
        }

        // Function to update cart item quantity
        function updateCart(itemId, newQuantity) {
            if (newQuantity < 1) return;

            const csrfToken = getCookie('csrftoken');
            if (!csrfToken) {
                showToast('Session expired. Please refresh the page.', 'error');
                return;
            }

            fetch(`{% url 'menu:update_cart' 0 %}`.replace('0', itemId), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({ quantity: newQuantity })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, 'error');
                } else {
                    updateCartCount(data.cart_items.length);
                    updateCartPanel(data.cart_items);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Failed to update cart. Please try again.', 'error');
            });
        }

        // Function to remove item from cart
        function removeFromCart(itemId) {
            const csrfToken = getCookie('csrftoken');
            if (!csrfToken) {
                showToast('Session expired. Please refresh the page.', 'error');
                return;
            }

            fetch(`{% url 'menu:remove_from_cart' 0 %}`.replace('0', itemId), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, 'error');
                } else {
                    showToast('Item removed from cart');
                    updateCartCount(data.cart_items.length);
                    updateCartPanel(data.cart_items);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Failed to remove item from cart. Please try again.', 'error');
            });
        }

        // Function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Function to show toast messages
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Initialize cart on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch initial cart data
            fetch('{% url "menu:view_cart" %}')
                .then(response => response.json())
                .then(data => {
                    if (data.cart_items) {
                        updateCartCount(data.cart_items.length);
                        updateCartPanel(data.cart_items);
                    } else {
                        updateCartCount(0);
                    }
                })
                .catch(error => {
                    console.error('Error fetching cart:', error);
                    updateCartCount(0);
                });

            // Initialize filters
            const allItemsCategory = document.querySelector('.filter-option[data-category="all"]');
            const allItemsAvailability = document.querySelector('.filter-option[data-availability="all"]');

            if (allItemsCategory) {
                allItemsCategory.classList.add('active');
            }
            if (allItemsAvailability) {
                allItemsAvailability.classList.add('active');
            }
        });

        // Filter functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize category filtering
            const filterOptions = document.querySelectorAll('.filter-option');
            const productCards = document.querySelectorAll('.product-card');

            function filterProducts() {
                const selectedCategory = document.querySelector('.filter-option[data-category].active')?.dataset.category;
                const selectedAvailability = document.querySelector('.filter-option[data-availability].active')?.dataset.availability;

                productCards.forEach(card => {
                    const categoryMatch = selectedCategory === 'all' || card.dataset.category === selectedCategory;
                    const availabilityMatch = selectedAvailability === 'all' || 
                        (selectedAvailability === 'available' && card.dataset.availability === 'true');
                    
                    card.style.display = categoryMatch && availabilityMatch ? 'block' : 'none';
                });
            }

            // Set initial active state for "All Items" in both category and availability filters
            const allItemsCategory = document.querySelector('.filter-option[data-category="all"]');
            const allItemsAvailability = document.querySelector('.filter-option[data-availability="all"]');
            
            if (allItemsCategory) {
                allItemsCategory.classList.add('active');
            }
            if (allItemsAvailability) {
                allItemsAvailability.classList.add('active');
            }

            filterOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const filterGroup = this.closest('.filter-group');
                    filterGroup.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    filterProducts();
                });
            });

            // Trigger initial filter immediately
            filterProducts();
        });

        // Close cart when clicking outside
        document.addEventListener('click', function(event) {
            const cartPanel = document.querySelector('.cart-panel');
            const ribbon = document.querySelector('.ribbon');
            
            if (!cartPanel.contains(event.target) && 
                !ribbon.contains(event.target) && 
                cartPanel.classList.contains('active')) {
                cartPanel.classList.remove('active');
            }
        });

        // Simple cart check function
        function checkCart(event) {
            const cartItems = document.querySelector('.cart-items');
            if (!cartItems || cartItems.querySelector('.empty-cart')) {
                event.preventDefault();
                showToast('Your cart is empty. Please add items before proceeding to checkout.', 'error');
                return false;
            }
            return true;
        }

        // Enhanced search functionality
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        let searchTimeout;

        function highlightText(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function searchItems(query) {
            const productCards = document.querySelectorAll('.product-card');
            const results = Array.from(productCards).filter(card => {
                const title = card.querySelector('.product-title').textContent.toLowerCase();
                const description = card.querySelector('.product-description').textContent.toLowerCase();
                const category = card.dataset.category.toLowerCase();
                return title.includes(query) || 
                       description.includes(query) || 
                       category.includes(query);
            });

            if (results.length > 0) {
                searchResults.innerHTML = results.map(card => {
                    const title = card.querySelector('.product-title').textContent;
                    const description = card.querySelector('.product-description').textContent;
                    const price = card.querySelector('.product-price').textContent;
                    const image = card.querySelector('.product-image').src;
                    const category = card.dataset.category;
                    const availability = card.dataset.availability === 'true';
                    const itemId = card.dataset.itemId;

                    return `
                        <div class="search-result-item" data-item-id="${itemId}">
                            <img src="${image}" alt="${title}" onerror="this.src='/static/menu/images/default-food.jpg'">
                            <div class="search-result-details">
                                <h3>
                                    ${highlightText(title, query)}
                                    <span class="search-result-availability ${availability ? 'search-result-available' : 'search-result-unavailable'}">
                                        ${availability ? 'Available' : 'Out of Stock'}
                                    </span>
                                </h3>
                                <p>${highlightText(description, query)}</p>
                                <div class="search-result-category">
                                    <i class="fas fa-tag"></i> ${highlightText(category, query)}
                                </div>
                            </div>
                            <div class="search-result-price">${price}</div>
                            <button class="search-result-cart-btn ${!availability ? 'disabled' : ''}" 
                                    onclick="event.stopPropagation(); addToCart(${itemId})"
                                    ${!availability ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus"></i>
                            </button>
                        </div>
                    `;
                }).join('');
                searchResults.classList.add('active');
            } else {
                searchResults.innerHTML = `
                    <div class="search-result-item">
                        <div class="search-result-details">
                            <h3>No items found</h3>
                            <p>Try searching with different keywords or browse our menu categories.</p>
                        </div>
                    </div>
                `;
                searchResults.classList.add('active');
            }
        }

        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim().toLowerCase();

            if (query.length < 2) {
                searchResults.classList.remove('active');
                return;
            }

            searchTimeout = setTimeout(() => {
                searchItems(query);
            }, 300);
        });

        // Close search results when clicking outside
        document.addEventListener('click', function(event) {
            if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
                searchResults.classList.remove('active');
            }
        });

        // Function to scroll to item
        function scrollToItem(itemId) {
            const item = document.querySelector(`[data-item-id="${itemId}"]`);
            if (item) {
                item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                searchResults.classList.remove('active');
                searchInput.value = '';
            }
        }

        // Add keyboard navigation for search results
        searchInput.addEventListener('keydown', function(event) {
            const results = searchResults.querySelectorAll('.search-result-item');
            const activeResult = searchResults.querySelector('.search-result-item.active');
            
            if (!searchResults.classList.contains('active')) return;

            switch(event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    if (!activeResult) {
                        results[0]?.classList.add('active');
                    } else {
                        const next = activeResult.nextElementSibling;
                        if (next) {
                            activeResult.classList.remove('active');
                            next.classList.add('active');
                        }
                    }
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    if (!activeResult) {
                        results[results.length - 1]?.classList.add('active');
                    } else {
                        const prev = activeResult.previousElementSibling;
                        if (prev) {
                            activeResult.classList.remove('active');
                            prev.classList.add('active');
                        }
                    }
                    break;
                case 'Enter':
                    if (activeResult) {
                        activeResult.click();
                    }
                    break;
                case 'Escape':
                    searchResults.classList.remove('active');
                    searchInput.value = '';
                    break;
            }
        });

        // Function to show confirmation dialog
        function showConfirmationDialog(message, onConfirm, onCancel) {
            const dialog = document.createElement('div');
            dialog.className = 'confirmation-dialog';
            dialog.innerHTML = `
                <div class="confirmation-content">
                    <h3>Confirm Action</h3>
                    <p>${message}</p>
                    <div class="confirmation-buttons">
                        <button class="confirmation-btn confirm">Confirm</button>
                        <button class="confirmation-btn cancel">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(dialog);

            // Show dialog with animation
            setTimeout(() => dialog.classList.add('active'), 10);

            // Handle button clicks
            dialog.querySelector('.confirm').addEventListener('click', () => {
                dialog.classList.remove('active');
                setTimeout(() => {
                    dialog.remove();
                    if (onConfirm) onConfirm();
                }, 300);
            });

            dialog.querySelector('.cancel').addEventListener('click', () => {
                dialog.classList.remove('active');
                setTimeout(() => {
                    dialog.remove();
                    if (onCancel) onCancel();
                }, 300);
            });
        }
    </script>
</body>
</html> 